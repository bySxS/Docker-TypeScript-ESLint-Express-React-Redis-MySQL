version: '3.9'

services:
#  redis:
#    image: redis:alpine
#    restart: always
#    ports:
#      - "6379:6379"
#    command: redis-server --daemonize yes --save 20 1 --loglevel warning
  server_express:
    build:
      context: ./server-express
    deploy:
      replicas: 3
#     resources:
#       limits:
#         cpus: "0.1"
#         memory: '50M'
      restart_policy:
        condition: on-failure
    command: sh -c 'npm run migrate && npm run seedAdd'
    working_dir: /usr/src/app
#  nginx:
#    restart: always
#    build:
#      context: ./nginx-reverseProxy
#    ports:
#      - "80:80"

networks:
  default:
    name: net